rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // TESTING ONLY: allow any authenticated user full read/write access.
    // This is insecure and must be tightened before production.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // TESTING ONLY: allow any authenticated user full read/write access.
    // This is insecure and must be tightened before production.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // TESTING ONLY: allow any authenticated user full read/write access.
    // This is insecure and must be tightened before production.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // TESTING ONLY: Allow authenticated users whose `users/{uid}.role == 'recruiter'`
    // full read/write access to all documents. This is permissive and unsafe for
    // production; use only for local/dev testing.
    match /{document=**} {
      allow read, write: if request.auth != null
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'recruiter';
    }

  }
}
        );
        match /{subCollection=**} {
          allow read, write: if request.auth != null && (
            request.auth.uid == userDoc ||
            isUniAdmin(request.auth.uid, uni) ||
            isSuperAdmin(request.auth.uid)
          );
        }
      }

      match /{subCollection=**} {
        allow read: if true;
        allow write: if request.auth != null && (isSuperAdmin(request.auth.uid) || isUniAdmin(request.auth.uid, uni));
      }
    }

    // ==========================================================
    // 5. POSTS (Lost & Found Root)
    // ==========================================================
    match /posts/{postId} {
      allow read: if true;
      allow create: if request.auth != null && request.resource.data.uid == request.auth.uid;
      allow update, delete: if request.auth != null && (
        resource.data.uid == request.auth.uid ||
        isSuperAdmin(request.auth.uid)
      );
    }

    match /super_admins/{uid} {
      allow read, write: if request.auth != null && isSuperAdmin(request.auth.uid);
    }

    // Jobs collection stored at root
    match /jobs/{jobId} {
      // Anyone can read active jobs
      allow read: if true;

      // Create: recruiters or super-admins (recruiterId must match caller)
      allow create: if request.auth != null && (
        request.auth.uid == request.resource.data.recruiterId ||
        exists(/databases/$(database)/documents/super_admins/$(request.auth.uid)) ||
        // university admin for job's target university
        rules_version = '2';
        service cloud.firestore {
          match /databases/{database}/documents {
            // TESTING ONLY: allow any authenticated user full read/write access.
            // This is insecure and must be tightened before production.
            allow read, write: if request.auth != null;
          }
        }